import{r as _,c as V,a,b as o,u as l,e as t,C as b,m as x,d as m,s as n,q as y,h as w,j as F,k as J,i as N}from"./index-CQNOpYTI.js";import{C as k}from"./CButton-17-Jpi_Q.js";import{C as g}from"./CCardHeader-BWvtasq5.js";import{C as B}from"./CForm-DvIUpcIO.js";import{C as d}from"./CFormInput-C-0ws8Xw.js";import{C as i}from"./CFormTextarea-CWqCO8lO.js";import{C as S,a as u}from"./CRow-48zaJ1dN.js";import{_ as U}from"./FormulaGlossary-WWqxRu_J.js";const L={class:"p-3"},O={class:"mt-3 d-flex gap-2"},A={class:"mt-3 d-flex gap-2"},M={__name:"FormulaCreate",setup(E){const p=F(),s=_({name:"",expression:"",description:"",variablesJson:""}),f=async()=>{await N.post("/api/formulas",{name:s.value.name,expression:s.value.expression,description:s.value.description||null,variablesJson:s.value.variablesJson?JSON.parse(s.value.variablesJson):null},{withCredentials:!0}),p.push({name:"FormulasList"})};return(v,e)=>{const C=y("router-link");return J(),V("div",L,[a(l(w),null,{default:o(()=>[a(l(g),{class:"fw-semibold"},{default:o(()=>e[4]||(e[4]=[t("New Formula",-1)])),_:1,__:[4]}),a(l(b),null,{default:o(()=>[a(l(B),{onSubmit:x(f,["prevent"])},{default:o(()=>[a(l(S),{class:"g-3"},{default:o(()=>[a(l(u),{md:"6"},{default:o(()=>[a(l(n),null,{default:o(()=>e[5]||(e[5]=[t("Name",-1)])),_:1,__:[5]}),a(l(d),{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>s.value.name=r)},null,8,["modelValue"])]),_:1}),a(l(u),{md:"12"},{default:o(()=>[a(l(n),null,{default:o(()=>e[6]||(e[6]=[t("Expression",-1)])),_:1,__:[6]}),a(l(d),{modelValue:s.value.expression,"onUpdate:modelValue":e[1]||(e[1]=r=>s.value.expression=r),placeholder:"e.g. clamp(value * rate / 100, 0, cap)"},null,8,["modelValue"]),e[7]||(e[7]=m("small",{class:"text-muted"},"Vars available: value, rate + any you add in Variables JSON. Helpers: clamp, min, max, round.",-1))]),_:1,__:[7]}),a(l(u),{md:"12"},{default:o(()=>[a(l(n),null,{default:o(()=>e[8]||(e[8]=[t("Variables JSON (optional)",-1)])),_:1,__:[8]}),a(l(i),{rows:"2",modelValue:s.value.variablesJson,"onUpdate:modelValue":e[2]||(e[2]=r=>s.value.variablesJson=r),placeholder:'e.g. ["rate","cap"] or [{"key":"cap","label":"Cap","default":20000}]'},null,8,["modelValue"])]),_:1}),a(l(u),{md:"12"},{default:o(()=>[a(l(n),null,{default:o(()=>e[9]||(e[9]=[t("Description (optional)",-1)])),_:1,__:[9]}),a(l(i),{rows:"3",modelValue:s.value.description,"onUpdate:modelValue":e[3]||(e[3]=r=>s.value.description=r)},null,8,["modelValue"])]),_:1})]),_:1}),m("div",O,[a(l(k),{type:"submit",color:"primary"},{default:o(()=>e[10]||(e[10]=[t("Save",-1)])),_:1,__:[10]}),a(C,{class:"btn btn-secondary",to:{name:"FormulasList"}},{default:o(()=>e[11]||(e[11]=[t("Cancel",-1)])),_:1,__:[11]})]),m("div",A,[a(U,{onApply:v.applyFromGlossary},null,8,["onApply"])])]),_:1})]),_:1})]),_:1})])}}};export{M as default};

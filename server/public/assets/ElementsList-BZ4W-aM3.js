import{r as v,o as D,i as w,n as N,c as i,a as t,b as a,u as l,d as x,t as f,C as V,q as F,e as o,l as h,F as L,g as S,h as $,k as r}from"./index-CQNOpYTI.js";import{C as H}from"./CButton-17-Jpi_Q.js";import{C as q}from"./CCardHeader-BWvtasq5.js";import{C as P}from"./CFormInput-C-0ws8Xw.js";import{C as R,a as g}from"./CRow-48zaJ1dN.js";import{C as E}from"./CSpinner-EBzRx-qA.js";import{a as j,b as T,c as _,d as z,C as I,e as c}from"./CTable-DqhvKdog.js";const M={class:"p-3"},U={class:"d-flex align-items-center justify-content-between w-100"},G={class:"text-muted ms-2"},J={key:0,class:"py-3"},K={key:1},O={key:0},Q={key:1},W={key:1,class:"text-muted"},X={key:2,class:"py-3"},re={__name:"ElementsList",setup(Y){const m=v(!0),d=v([]),p=v("");D(async()=>{await A()});const A=async()=>{m.value=!0;try{const{data:n}=await w.get("/api/element-definitions",{withCredentials:!0});d.value=Array.isArray(n)?n:n.elements||[]}finally{m.value=!1}},b=N(()=>{const n=p.value.trim().toLowerCase();return n?d.value.filter(e=>[e.name,e.formula,e.notes].filter(Boolean).some(u=>String(u).toLowerCase().includes(n))):d.value}),B=async n=>{var e,u;if(confirm("Delete this element? This cannot be undone."))try{await w.delete(`/api/element-definitions/${n}`,{withCredentials:!0}),d.value=d.value.filter(s=>s.id!==n),alert("Element deleted.")}catch(s){if(((e=s==null?void 0:s.response)==null?void 0:e.status)===409){const C=((u=s.response.data)==null?void 0:u.count)??0;if(!confirm(`This element is attached to ${C} plan${C===1?"":"s"}.
Do you want to detach it from all and delete it?`))return;try{await w.delete(`/api/element-definitions/${n}?force=1`,{withCredentials:!0}),d.value=d.value.filter(y=>y.id!==n),alert("Detached from all plans and deleted.")}catch(y){console.error(y),alert("Force delete failed.")}}else console.error(s),alert("Error deleting element.")}};return(n,e)=>{const u=F("router-link");return r(),i("div",M,[t(l($),null,{default:a(()=>[t(l(q),{class:"fw-semibold"},{default:a(()=>[x("div",U,[e[1]||(e[1]=x("span",null,"All Plan Elements",-1)),x("small",G,"("+f(d.value.length)+")",1)])]),_:1}),t(l(V),null,{default:a(()=>[t(l(R),{class:"g-3 mb-3"},{default:a(()=>[t(l(g),{md:"6"},{default:a(()=>[t(l(P),{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),placeholder:"Search by name, formula, or notes..."},null,8,["modelValue"])]),_:1}),t(l(g),{md:"6",class:"text-end"},{default:a(()=>[t(u,{class:"btn btn-primary",to:{name:"AddPlanElement"}},{default:a(()=>e[2]||(e[2]=[o("Add Element",-1)])),_:1,__:[2]})]),_:1})]),_:1}),m.value?(r(),i("div",J,[t(l(E))])):(r(),i("div",K,[!m.value&&b.value.length?(r(),h(l(I),{key:0,hover:"",responsive:""},{default:a(()=>[t(l(j),null,{default:a(()=>[t(l(T),null,{default:a(()=>[t(l(_),{style:{"min-width":"220px"}},{default:a(()=>e[3]||(e[3]=[o("Name",-1)])),_:1,__:[3]}),t(l(_),{style:{"min-width":"320px"}},{default:a(()=>e[4]||(e[4]=[o("Formula",-1)])),_:1,__:[4]}),t(l(_),{style:{"min-width":"280px"}},{default:a(()=>e[5]||(e[5]=[o("Notes",-1)])),_:1,__:[5]}),t(l(_),{style:{"min-width":"160px"}},{default:a(()=>e[6]||(e[6]=[o("Created",-1)])),_:1,__:[6]}),t(l(_),{style:{"min-width":"140px"}},{default:a(()=>e[7]||(e[7]=[o("Actions",-1)])),_:1,__:[7]})]),_:1})]),_:1}),t(l(z),null,{default:a(()=>[(r(!0),i(L,null,S(b.value,(s,k)=>(r(),h(l(T),{key:s.id??s.name??k},{default:a(()=>[t(l(c),{class:"fw-semibold"},{default:a(()=>[o(f(s.name),1)]),_:2},1024),t(l(c),{class:"text-truncate",style:{"max-width":"420px"}},{default:a(()=>[s.formula?(r(),i("code",O,f(s.formula),1)):(r(),i("span",Q,"—"))]),_:2},1024),t(l(c),{class:"text-truncate",style:{"max-width":"360px"}},{default:a(()=>[o(f(s.notes||"—"),1)]),_:2},1024),t(l(c),null,{default:a(()=>[o(f(s.createdAt?new Date(s.createdAt).toLocaleString():"—"),1)]),_:2},1024),t(l(c),null,{default:a(()=>[t(u,{class:"btn btn-sm btn-outline-primary me-2",to:{name:"ElementEdit",params:{id:s.id}}},{default:a(()=>e[8]||(e[8]=[o("Edit",-1)])),_:2,__:[8]},1032,["to"]),t(l(H),{color:"danger",size:"sm",onClick:C=>B(s.id)},{default:a(()=>e[9]||(e[9]=[o("Delete",-1)])),_:2,__:[9]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):m.value?(r(),i("div",X,[t(l(E))])):(r(),i("div",W,"No elements found."))]))]),_:1})]),_:1})])}}};export{re as default};

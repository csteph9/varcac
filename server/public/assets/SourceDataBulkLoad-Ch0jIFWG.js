import{r as v,c,a as t,w as o,u as r,b as s,e as l,n as x,C as S,k as w,d as b,l as L,p as V,t as p,F as R,f as N,g as B,i as A,j as d,h as E}from"./index-DzErGyIl.js";import{C as y}from"./CAlert-D4L7jOoy.js";import{C as D}from"./CButton-C8OFNrn1.js";import{C as I}from"./CCardHeader-CoIivghT.js";import{C as F}from"./CForm-B_iW6YhG.js";import{C as M}from"./CFormTextarea-DAK_ED2w.js";import{C as P,a as Q}from"./CRow-B9EqYIPJ.js";const T={class:"p-3"},U={class:"d-flex gap-2"},h={class:"d-flex gap-2 mt-4"},j={key:1,class:"mt-3"},H={key:0},O={class:"mb-0"},Y={__name:"SourceDataBulkLoad",setup($){A();const f=v(""),n=v(null),_=v("");async function k(){var C,e,i,m,u;_.value="",n.value=null;try{const{data:a}=await E.post("/api/source-data/bulk",{csv:f.value},{withCredentials:!0});n.value=a,alert(`Inserted ${a.inserted} row(s)`+((C=a.errors)!=null&&C.length?`; ${a.errors.length} error(s)`:""))}catch(a){_.value=((i=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:i.detail)||((u=(m=a==null?void 0:a.response)==null?void 0:m.data)==null?void 0:u.error)||a.message}}function g(){f.value=`Participant ID,Data Source Label,Description,Date,Value
101,NEW_ARR,ACME deal,2025-02-01,50000
101,RETAIN_NR,Q1 retain %,2025-02-15,0.78
102,ARR_QUOTA,Quota for Q1,2025-01-01,250000
102,EXPANSION,Upsell,2025-03-10,12000`}return(C,e)=>{const i=x("router-link");return d(),c("div",T,[t(r(B),null,{default:o(()=>[t(r(I),{class:"fw-semibold d-flex justify-content-between align-items-center"},{default:o(()=>[e[3]||(e[3]=s("span",null,"Bulk Load Source Data (CSV)",-1)),s("div",U,[t(r(D),{color:"secondary",variant:"outline",onClick:g},{default:o(()=>e[1]||(e[1]=[l("Load Example",-1)])),_:1,__:[1]}),t(i,{class:"btn btn-outline-primary",to:{name:"SourceDataList"}},{default:o(()=>e[2]||(e[2]=[l("Back to List",-1)])),_:1,__:[2]})])]),_:1,__:[3]}),t(r(S),null,{default:o(()=>{var m;return[t(r(F),{onSubmit:L(k,["prevent"])},{default:o(()=>[t(r(P),{class:"g-3"},{default:o(()=>[t(r(Q),{md:"12"},{default:o(()=>[t(r(V),null,{default:o(()=>e[4]||(e[4]=[l("Paste CSV",-1)])),_:1,__:[4]}),t(r(M),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=u=>f.value=u),rows:"12",placeholder:"Participant ID,Data Source Label,Description,Date,Value",style:{"font-family":"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Courier New', monospace"}},null,8,["modelValue"]),e[5]||(e[5]=s("small",{class:"text-body-secondary"},[l(" Required headers: "),s("code",null,"Participant ID"),l(", "),s("code",null,"Data Source Label"),l(", "),s("code",null,"Date"),l(", "),s("code",null,"Value"),l(". (Header names are flexible.) ")],-1))]),_:1,__:[5]})]),_:1}),s("div",h,[t(r(D),{type:"submit",color:"primary"},{default:o(()=>e[6]||(e[6]=[l("Upload",-1)])),_:1,__:[6]}),t(i,{class:"btn btn-secondary",to:{name:"SourceDataList"}},{default:o(()=>e[7]||(e[7]=[l("Cancel",-1)])),_:1,__:[7]})])]),_:1}),_.value?(d(),w(r(y),{key:0,color:"danger",class:"mt-3"},{default:o(()=>[l(p(_.value),1)]),_:1})):b("",!0),n.value?(d(),c("div",j,[t(r(y),{color:"success"},{default:o(()=>[l("Inserted: "+p(n.value.inserted),1)]),_:1}),(m=n.value.errors)!=null&&m.length?(d(),c("div",H,[s("h6",null,"Row errors ("+p(n.value.errors.length)+")",1),s("ul",O,[(d(!0),c(R,null,N(n.value.errors,(u,a)=>(d(),c("li",{key:a}," Line "+p(u.line)+" â€” "+p(u.error),1))),128))])])):b("",!0)])):b("",!0)]}),_:1})]),_:1})])}}};export{Y as default};

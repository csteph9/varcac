import{r as c,o as w,s as x,c as A,a as l,w as r,u as a,e as i,C as g,k as V,d as _,t as b,l as k,b as d,p as u,F as B,f as D,g as E,h as y,i as P,j as m}from"./index-DY2iYVHx.js";import{C as O}from"./CAlert-DmuhYrdh.js";import{C as T}from"./CButton-CBg_h1uZ.js";import{C as H}from"./CCardHeader-CxJUXy8l.js";import{C as j}from"./CForm-DPT3EXTc.js";import{C}from"./CFormInput-cfDnsWz9.js";import{C as M}from"./CFormSelect-CedCeGDc.js";import{C as W}from"./CFormTextarea-8IlUvhIZ.js";import{C as z,a as n}from"./CRow-CoYbaDgy.js";import{C as X}from"./CSpinner-FP7r2lwx.js";const $={class:"p-3"},q=["value"],G={class:"form-text"},J={class:"d-flex gap-2 mt-4"},de={__name:"SourceDataAdd",setup(K){const F=P(),S=c([]),f=c(!0),p=c("");async function N(){var v,e;p.value="",f.value=!0;try{const{data:t}=await y.get("/api/participants",{withCredentials:!0}),R=Array.isArray(t)?t:(t==null?void 0:t.items)||(t==null?void 0:t.participants)||[];S.value=R.map(s=>({id:s.id,name:[s.firstName,s.lastName].filter(Boolean).join(" ")||`Participant ${s.id}`})).sort((s,U)=>s.name.localeCompare(U.name))}catch(t){console.error(t),p.value=((e=(v=t==null?void 0:t.response)==null?void 0:v.data)==null?void 0:e.error)||"Failed to load participants"}finally{f.value=!1}}w(N);const o=x({participantId:"",recordScope:"",label:"",description:"",date:"",value:""});async function L(){await y.post("/api/source-data",{participantId:Number(o.participantId),recordScope:(o.recordScope||"ACTUAL").trim()||"ACTUAL",label:o.label.trim(),description:o.description||null,date:o.date,value:Number(o.value)},{withCredentials:!0}),alert("Record added"),F.push({name:"SourceDataList"})}function I(){o.participantId="",o.recordScope="",o.label="",o.description="",o.date="",o.value=""}return(v,e)=>(m(),A("div",$,[l(a(E),null,{default:r(()=>[l(a(H),{class:"fw-semibold"},{default:r(()=>e[6]||(e[6]=[i("Add Source Data",-1)])),_:1,__:[6]}),l(a(g),null,{default:r(()=>[p.value?(m(),V(a(O),{key:0,color:"danger",class:"mb-3"},{default:r(()=>[i(b(p.value),1)]),_:1})):_("",!0),l(a(j),{onSubmit:k(L,["prevent"])},{default:r(()=>[l(a(z),{class:"g-3"},{default:r(()=>[l(a(n),{md:"4"},{default:r(()=>[l(a(u),null,{default:r(()=>e[7]||(e[7]=[i("Participant",-1)])),_:1,__:[7]}),l(a(M),{modelValue:o.participantId,"onUpdate:modelValue":e[0]||(e[0]=t=>o.participantId=t),disabled:f.value||!!p.value},{default:r(()=>[e[8]||(e[8]=d("option",{value:"",disabled:""},"Select a participant…",-1)),(m(!0),A(B,null,D(S.value,t=>(m(),A("option",{key:t.id,value:t.id},b(t.name)+" (#"+b(t.id)+") ",9,q))),128))]),_:1,__:[8]},8,["modelValue","disabled"]),d("div",G,[f.value?(m(),V(a(X),{key:0,size:"sm",class:"me-2"})):_("",!0),e[9]||(e[9]=i(" Choose by name; the ID is sent automatically. ",-1))])]),_:1}),l(a(n),{md:"4"},{default:r(()=>[l(a(u),null,{default:r(()=>e[10]||(e[10]=[i("Record Scope",-1)])),_:1,__:[10]}),l(a(C),{modelValue:o.recordScope,"onUpdate:modelValue":e[1]||(e[1]=t=>o.recordScope=t),list:"scopeHints",placeholder:"ACTUAL, FCST, FORECAST, PLAN, …"},null,8,["modelValue"]),e[11]||(e[11]=d("datalist",{id:"scopeHints"},[d("option",{value:"ACTUAL"}),d("option",{value:"ACT"}),d("option",{value:"FORECAST"}),d("option",{value:"FCST"}),d("option",{value:"FCST1"}),d("option",{value:"FCST2"}),d("option",{value:"PLAN"}),d("option",{value:"WHATIF"})],-1)),e[12]||(e[12]=d("small",{class:"text-body-secondary"},[i("Optional; defaults to "),d("code",null,"ACTUAL"),i(".")],-1))]),_:1,__:[11,12]}),l(a(n),{md:"4"},{default:r(()=>[l(a(u),null,{default:r(()=>e[13]||(e[13]=[i("Label",-1)])),_:1,__:[13]}),l(a(C),{modelValue:o.label,"onUpdate:modelValue":e[2]||(e[2]=t=>o.label=t),placeholder:"NEW_ARR, EXPANSION, RETAIN_NR…"},null,8,["modelValue"])]),_:1}),l(a(n),{md:"4"},{default:r(()=>[l(a(u),null,{default:r(()=>e[14]||(e[14]=[i("Date",-1)])),_:1,__:[14]}),l(a(C),{type:"date",modelValue:o.date,"onUpdate:modelValue":e[3]||(e[3]=t=>o.date=t)},null,8,["modelValue"])]),_:1}),l(a(n),{md:"4"},{default:r(()=>[l(a(u),null,{default:r(()=>e[15]||(e[15]=[i("Value",-1)])),_:1,__:[15]}),l(a(C),{type:"number",step:"0.0001",modelValue:o.value,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value=t)},null,8,["modelValue"])]),_:1}),l(a(n),{md:"12"},{default:r(()=>[l(a(u),null,{default:r(()=>e[16]||(e[16]=[i("Description",-1)])),_:1,__:[16]}),l(a(W),{rows:"3",modelValue:o.description,"onUpdate:modelValue":e[5]||(e[5]=t=>o.description=t),placeholder:"Optional description…"},null,8,["modelValue"])]),_:1})]),_:1}),d("div",J,[l(a(T),{type:"submit",color:"primary"},{default:r(()=>e[17]||(e[17]=[i("Save",-1)])),_:1,__:[17]}),l(a(T),{type:"button",color:"secondary",onClick:I},{default:r(()=>e[18]||(e[18]=[i("Reset",-1)])),_:1,__:[18]})])]),_:1})]),_:1})]),_:1})]))}};export{de as default};

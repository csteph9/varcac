import{r as _,x as k,o as x,c as C,a as o,b as r,u as l,e as i,C as w,l as N,f as b,t as A,m as P,d,s as u,F as B,g as D,h as E,i as F,j as O,k as p}from"./index-CQNOpYTI.js";import{C as H}from"./CAlert-DFnM9774.js";import{C as I}from"./CButton-17-Jpi_Q.js";import{C as j}from"./CCardHeader-BWvtasq5.js";import{C as M}from"./CForm-DvIUpcIO.js";import{C as c}from"./CFormInput-C-0ws8Xw.js";import{C as W}from"./CFormSelect-BzcGRyFc.js";import{C as z}from"./CFormTextarea-CWqCO8lO.js";import{C as X,a as m}from"./CRow-48zaJ1dN.js";import{C as $}from"./CSpinner-EBzRx-qA.js";const q={class:"p-3"},G={key:0,value:"",disabled:""},J=["value"],K={class:"form-text"},Q={class:"d-flex gap-2 mt-4"},se={__name:"SourceDataAdd",setup(Y){const T=O(),V=_([]),v=_(!0),f=_(""),a=k({participantId:null,recordScope:"",label:"",description:"",date:"",value:""});async function L(){var n,e;f.value="",v.value=!0;try{const{data:t}=await F.get("/api/participants",{withCredentials:!0}),S=(Array.isArray(t)?t:(t==null?void 0:t.items)||(t==null?void 0:t.participants)||[]).map(s=>({id:Number(s.id),name:[s.firstName,s.lastName].filter(Boolean).join(" ")||`Participant ${s.id}`})).sort((s,U)=>s.name.localeCompare(U.name));V.value=S,(a.participantId===null||a.participantId==="")&&S.length>0&&(a.participantId=String(S[0].id))}catch(t){console.error(t),f.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.error)||"Failed to load participants"}finally{v.value=!1}}x(L);function y(n){const e=Number(n);return Number.isFinite(e)?e:NaN}async function g(){const n=y(a.participantId);if(!Number.isFinite(n)||n<=0){alert("Please select a participant.");return}await F.post("/api/source-data",{participantId:n,recordScope:(a.recordScope||"ACTUAL").trim()||"ACTUAL",label:(a.label||"").trim(),description:a.description||null,date:a.date,value:y(a.value)},{withCredentials:!0}),alert("Record added"),T.push({name:"SourceDataList"})}function R(){const n=a.participantId;a.recordScope="",a.label="",a.description="",a.date="",a.value="",a.participantId=n}return(n,e)=>(p(),C("div",q,[o(l(E),null,{default:r(()=>[o(l(j),{class:"fw-semibold"},{default:r(()=>e[6]||(e[6]=[i("Add Source Data",-1)])),_:1,__:[6]}),o(l(w),null,{default:r(()=>[f.value?(p(),N(l(H),{key:0,color:"danger",class:"mb-3"},{default:r(()=>[i(A(f.value),1)]),_:1})):b("",!0),o(l(M),{onSubmit:P(g,["prevent"])},{default:r(()=>[o(l(X),{class:"g-3"},{default:r(()=>[o(l(m),{md:"4"},{default:r(()=>[o(l(u),null,{default:r(()=>e[7]||(e[7]=[i("Participant",-1)])),_:1,__:[7]}),o(l(W),{modelValue:a.participantId,"onUpdate:modelValue":e[0]||(e[0]=t=>a.participantId=t)},{default:r(()=>[a.participantId===null?(p(),C("option",G,"Select a participant…")):b("",!0),(p(!0),C(B,null,D(V.value,t=>(p(),C("option",{key:t.id,value:String(t.id)},A(t.name)+" (#"+A(t.id)+") ",9,J))),128))]),_:1},8,["modelValue"]),d("div",K,[v.value?(p(),N(l($),{key:0,size:"sm",class:"me-2"})):b("",!0),e[8]||(e[8]=i(" Choose by name; the ID is sent automatically. ",-1))])]),_:1}),o(l(m),{md:"4"},{default:r(()=>[o(l(u),null,{default:r(()=>e[9]||(e[9]=[i("Record Scope",-1)])),_:1,__:[9]}),o(l(c),{modelValue:a.recordScope,"onUpdate:modelValue":e[1]||(e[1]=t=>a.recordScope=t),list:"scopeHints",placeholder:"ACTUAL, FCST, FORECAST, PLAN, …"},null,8,["modelValue"]),e[10]||(e[10]=d("datalist",{id:"scopeHints"},[d("option",{value:"ACTUAL"}),d("option",{value:"ACT"}),d("option",{value:"FORECAST"}),d("option",{value:"FCST"}),d("option",{value:"FCST1"}),d("option",{value:"FCST2"}),d("option",{value:"PLAN"}),d("option",{value:"WHATIF"})],-1)),e[11]||(e[11]=d("small",{class:"text-body-secondary"},[i("Optional; defaults to "),d("code",null,"ACTUAL"),i(".")],-1))]),_:1,__:[10,11]}),o(l(m),{md:"4"},{default:r(()=>[o(l(u),null,{default:r(()=>e[12]||(e[12]=[i("Label",-1)])),_:1,__:[12]}),o(l(c),{modelValue:a.label,"onUpdate:modelValue":e[2]||(e[2]=t=>a.label=t),placeholder:"NEW_ARR, EXPANSION, RETAIN_NR…"},null,8,["modelValue"])]),_:1}),o(l(m),{md:"4"},{default:r(()=>[o(l(u),null,{default:r(()=>e[13]||(e[13]=[i("Date",-1)])),_:1,__:[13]}),o(l(c),{type:"date",modelValue:a.date,"onUpdate:modelValue":e[3]||(e[3]=t=>a.date=t)},null,8,["modelValue"])]),_:1}),o(l(m),{md:"4"},{default:r(()=>[o(l(u),null,{default:r(()=>e[14]||(e[14]=[i("Value",-1)])),_:1,__:[14]}),o(l(c),{type:"number",step:"0.0001",modelValue:a.value,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value=t)},null,8,["modelValue"])]),_:1}),o(l(m),{md:"12"},{default:r(()=>[o(l(u),null,{default:r(()=>e[15]||(e[15]=[i("Description",-1)])),_:1,__:[15]}),o(l(z),{rows:"3",modelValue:a.description,"onUpdate:modelValue":e[5]||(e[5]=t=>a.description=t),placeholder:"Optional description…"},null,8,["modelValue"])]),_:1})]),_:1}),d("div",Q,[o(l(I),{type:"submit",color:"primary"},{default:r(()=>e[16]||(e[16]=[i("Save",-1)])),_:1,__:[16]}),o(l(I),{type:"button",color:"secondary",onClick:R},{default:r(()=>e[17]||(e[17]=[i("Reset",-1)])),_:1,__:[17]})])]),_:1})]),_:1})]),_:1})]))}};export{se as default};

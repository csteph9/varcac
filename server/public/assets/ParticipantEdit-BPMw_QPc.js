import{r as C,s as T,o as L,c,a as n,w as l,u as i,e as d,C as O,l as Z,b as M,p as f,k as j,F as x,f as A,d as q,n as H,q as K,g as G,h as I,L as J,i as Q,j as u,t as W}from"./index-C5PjdH1u.js";import{C as X}from"./CButton-CmOQe7lx.js";import{C as Y}from"./CCardHeader-ZktOyhiF.js";import{C as h}from"./CForm-CUo11SnN.js";import{C as v}from"./CFormInput-BqrKVkSy.js";import{C as ee}from"./CFormSelect-BQ4o_mjU.js";import{C as te,a as m}from"./CRow-BjL7ivIQ.js";import{C as B}from"./CSpinner-CajLDNd3.js";const ae={class:"p-3"},ie={key:0,class:"py-5 text-center"},ne={key:1},le=["value"],re={class:"d-flex gap-2 mt-4"},Ne={__name:"ParticipantEdit",setup(se){const p=K(),F=Q(),_=C(!0),g=C(!1),V=C([{label:"— None —",value:""}]),b=C(0),t=T({firstName:"",lastName:"",email:"",employeeId:"",managerParticipantId:"",effectiveStart:"",effectiveEnd:""}),N=T({effectiveStart:null,effectiveEnd:null}),k=a=>{if(a==null)return null;if(typeof a=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(a))return{kind:"date-only"};if(/^\d{4}-\d{2}-\d{2}T.*Z$/.test(a))return{kind:"iso-z",timeSuffix:a.slice(10)};if(/^\d{4}-\d{2}-\d{2}T/.test(a))return{kind:"iso",timeSuffix:a.slice(10)}}return typeof a=="number"?{kind:"epoch-ms"}:Object.prototype.toString.call(a)==="[object Date]"?{kind:"date-obj"}:{kind:"unknown"}},w=a=>{if(!a)return"";if(typeof a=="string"&&/^\d{4}-\d{2}-\d{2}/.test(a))return a.slice(0,10);const e=new Date(a);return isNaN(e)?"":new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString().slice(0,10)},E=(a,e)=>{if(!a)return null;if(!e||!e.kind)return a;switch(e.kind){case"date-only":return a;case"iso-z":case"iso":return a+(e.timeSuffix||"T00:00:00.000Z");case"epoch-ms":{const o=Date.parse(a+"T00:00:00.000Z");return isNaN(o)?null:o}case"date-obj":{const o=Date.parse(a+"T00:00:00.000Z");return isNaN(o)?null:new Date(o)}default:return a}},z=async()=>{_.value=!0;try{const{data:a}=await I.get(`/api/participants/${p.params.id}`,{withCredentials:!0}),e=a.participant||a||{},o=e.managerParticipantId??e.manager_participant_id??e.managerId??e.manager_id??null,r=e.effectiveStart??e.effective_start??null,P=e.effectiveEnd??e.effective_end??null;N.effectiveStart=k(r),N.effectiveEnd=k(P),t.firstName=e.firstName??e.first_name??"",t.lastName=e.lastName??e.last_name??"",t.email=e.email??"",t.employeeId=e.employeeId??e.employee_id??"",t.managerParticipantId=o!=null?String(o):"",t.effectiveStart=w(r),t.effectiveEnd=w(P);const D=await I.get("/api/participants",{withCredentials:!0,params:{limit:5e3}}),U=D.data.participants||D.data||[],$=String(e.id??e.participantId??e.participant_id??p.params.id),S=[{label:"— None —",value:""},...U.filter(s=>String(s.id??s.participantId??s.participant_id)!==$).map(s=>{const y=String(s.id??s.participantId??s.participant_id);return{label:[s.firstName??s.first_name,s.lastName??s.last_name].filter(Boolean).join(" ")||s.email||`#${y}`,value:y}})];t.managerParticipantId&&!S.some(s=>s.value===t.managerParticipantId)&&S.push({label:`#${t.managerParticipantId}`,value:t.managerParticipantId}),V.value=S,await J(),b.value+=1}finally{_.value=!1}},R=async()=>{g.value=!0;try{const a={firstName:t.firstName||null,lastName:t.lastName||null,email:t.email||null,employeeId:t.employeeId||null,managerParticipantId:t.managerParticipantId===""?null:Number(t.managerParticipantId),effectiveStart:E(t.effectiveStart,N.effectiveStart),effectiveEnd:E(t.effectiveEnd,N.effectiveEnd)};await I.put(`/api/participants/${p.params.id}`,a,{withCredentials:!0}),F.push({name:"ParticipantDetail",params:{id:p.params.id}})}finally{g.value=!1}};return L(z),(a,e)=>{const o=H("router-link");return u(),c("div",ae,[n(i(G),null,{default:l(()=>[n(i(Y),{class:"fw-semibold"},{default:l(()=>e[6]||(e[6]=[d("Edit Participant",-1)])),_:1,__:[6]}),n(i(O),null,{default:l(()=>[_.value?(u(),c("div",ie,[n(i(B))])):(u(),c("div",ne,[n(i(h),{onSubmit:Z(R,["prevent"])},{default:l(()=>[n(i(te),{class:"g-3"},{default:l(()=>[n(i(m),{md:"4"},{default:l(()=>[n(i(f),null,{default:l(()=>e[7]||(e[7]=[d("First Name",-1)])),_:1,__:[7]}),n(i(v),{modelValue:t.firstName,"onUpdate:modelValue":e[0]||(e[0]=r=>t.firstName=r)},null,8,["modelValue"])]),_:1}),n(i(m),{md:"4"},{default:l(()=>[n(i(f),null,{default:l(()=>e[8]||(e[8]=[d("Last Name",-1)])),_:1,__:[8]}),n(i(v),{modelValue:t.lastName,"onUpdate:modelValue":e[1]||(e[1]=r=>t.lastName=r)},null,8,["modelValue"])]),_:1}),n(i(m),{md:"4"},{default:l(()=>[n(i(f),null,{default:l(()=>e[9]||(e[9]=[d("Email",-1)])),_:1,__:[9]}),n(i(v),{type:"email",modelValue:t.email,"onUpdate:modelValue":e[2]||(e[2]=r=>t.email=r)},null,8,["modelValue"])]),_:1}),n(i(m),{md:"5"},{default:l(()=>[n(i(f),null,{default:l(()=>e[10]||(e[10]=[d("Manager",-1)])),_:1,__:[10]}),(u(),j(i(ee),{modelValue:t.managerParticipantId,"onUpdate:modelValue":e[3]||(e[3]=r=>t.managerParticipantId=r),key:b.value},{default:l(()=>[(u(!0),c(x,null,A(V.value,r=>(u(),c("option",{key:r.value||"none",value:r.value},W(r.label),9,le))),128))]),_:1},8,["modelValue"]))]),_:1}),n(i(m),{md:"3"},{default:l(()=>[n(i(f),null,{default:l(()=>e[11]||(e[11]=[d("Effective Start",-1)])),_:1,__:[11]}),n(i(v),{type:"date",modelValue:t.effectiveStart,"onUpdate:modelValue":e[4]||(e[4]=r=>t.effectiveStart=r)},null,8,["modelValue"])]),_:1}),n(i(m),{md:"3"},{default:l(()=>[n(i(f),null,{default:l(()=>e[12]||(e[12]=[d("Effective End",-1)])),_:1,__:[12]}),n(i(v),{type:"date",modelValue:t.effectiveEnd,"onUpdate:modelValue":e[5]||(e[5]=r=>t.effectiveEnd=r)},null,8,["modelValue"])]),_:1})]),_:1}),M("div",re,[n(i(X),{type:"submit",color:"primary",disabled:g.value},{default:l(()=>[g.value?(u(),j(i(B),{key:0,size:"sm",class:"me-2"})):q("",!0),e[13]||(e[13]=d(" Save ",-1))]),_:1,__:[13]},8,["disabled"]),n(o,{class:"btn btn-secondary",to:{name:"ParticipantDetail",params:{id:i(p).params.id}}},{default:l(()=>e[14]||(e[14]=[d(" Cancel ",-1)])),_:1,__:[14]},8,["to"])])]),_:1})]))]),_:1})]),_:1})])}}};export{Ne as default};

import{r as p,c as o,a,w as r,u as l,e as d,C as V,d as C,l as g,b as i,p as B,n as h,t as u,F as x,f as D,g as E,j as n,h as F}from"./index-CvVN3E1C.js";import{C as b}from"./CAlert-DAtuXBMd.js";import{C as L}from"./CButton-BTssrhK7.js";import{C as N}from"./CCardHeader-BChnrtWq.js";import{C as U}from"./CForm-Dg8Z9R-d.js";import{C as S}from"./CFormCheck-CaP2q5LX.js";import{C as T}from"./CFormTextarea-CA4yEyBg.js";import{C as H}from"./CSpinner-BQ14nvNv.js";const A={class:"p-3"},I={class:"mb-3"},M={class:"mb-3"},O={class:"d-flex gap-2"},R={key:0},j={key:1},z={key:0,class:"mt-4"},G={key:0},K={class:"small"},P={key:1,class:"mt-4"},ae={__name:"DataBulkUpload",setup(W){const v=p(`participant_id,element_code,metric_date,value
1,NEW_ARR,2025-06-01,5000
1,MEETINGS_BOOKED,2025-06-01,5`),c=p(!0),_=p(!1),t=p(null),m=p(null),k=async()=>{var f;m.value=null,t.value=null,_.value=!0;try{const{data:e}=await F.post("/api/metrics/bulk",{csv:v.value,hasHeader:c.value},{withCredentials:!0});t.value=e}catch(e){m.value=((f=e==null?void 0:e.response)==null?void 0:f.data)||{error:"Upload failed"}}finally{_.value=!1}};return(f,e)=>{const y=h("router-link");return n(),o("div",A,[a(l(E),null,{default:r(()=>[a(l(N),{class:"fw-semibold"},{default:r(()=>e[2]||(e[2]=[d("Bulk Load Data",-1)])),_:1,__:[2]}),a(l(V),null,{default:r(()=>[a(l(U),{onSubmit:g(k,["prevent"])},{default:r(()=>[i("div",I,[a(l(B),null,{default:r(()=>e[3]||(e[3]=[d("Paste CSV",-1)])),_:1,__:[3]}),a(l(T),{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),rows:"10",placeholder:"participant_id,element_code,metric_date,value"},null,8,["modelValue"])]),i("div",M,[a(l(S),{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),label:"First row is header"},null,8,["modelValue"])]),i("div",O,[a(l(L),{type:"submit",color:"primary",disabled:_.value},{default:r(()=>[_.value?(n(),o("span",R,[a(l(H),{size:"sm",class:"me-2"}),e[4]||(e[4]=d("Uploading…",-1))])):(n(),o("span",j,"Upload"))]),_:1},8,["disabled"]),a(y,{class:"btn btn-secondary",to:{name:"DataList"}},{default:r(()=>e[5]||(e[5]=[d("View Loaded Data",-1)])),_:1,__:[5]})])]),_:1}),t.value?(n(),o("div",z,[a(l(b),{color:"success",class:"mb-3"},{default:r(()=>{var s;return[d(" Imported "+u(t.value.processed)+" rows ("+u(t.value.affected)+" affected DB rows).",1),e[6]||(e[6]=i("br",null,null,-1)),d(" "+u(((s=t.value.errors)==null?void 0:s.length)||0)+" errors. ",1)]}),_:1,__:[6]}),t.value.errors&&t.value.errors.length?(n(),o("div",G,[e[7]||(e[7]=i("h6",null,"Errors",-1)),i("ul",K,[(n(!0),o(x,null,D(t.value.errors,(s,w)=>(n(),o("li",{key:w},[d(" Line "+u(s.line)+": "+u(s.message)+" ",1),i("code",null,u(s.raw),1)]))),128))])])):C("",!0)])):C("",!0),m.value?(n(),o("div",P,[a(l(b),{color:"danger"},{default:r(()=>[d(u(m.value.error||"Error")+" — "+u(m.value.detail||""),1)]),_:1})])):C("",!0)]),_:1})]),_:1})])}}};export{ae as default};

import{r as v,c as m,a as o,b as l,u as r,d as s,e as t,q as R,C as g,l as L,f as b,m as x,s as A,t as p,F as V,g as w,h as N,j as B,k as d,i as T}from"./index-CFGD_Gi7.js";import{C as y}from"./CAlert-DAczoeYR.js";import{C as S}from"./CButton-Bar-IVn5.js";import{C as E}from"./CCardHeader-j1dVyNP9.js";import{C as F}from"./CForm-8Di4je1x.js";import{C as I}from"./CFormTextarea-_3z2L8bv.js";import{C as U,a as M}from"./CRow-CQIQrd1B.js";const P={class:"p-3"},h={class:"d-flex gap-2"},O={class:"d-flex gap-2 mt-4"},Q={key:1,class:"mt-3"},j={key:0},q={class:"mb-0"},Y={__name:"SourceDataBulkLoad",setup(H){B();const f=v(""),n=v(null),C=v("");async function D(){var _,e,i,c,u;C.value="",n.value=null;try{const{data:a}=await T.post("/api/source-data/bulk",{csv:f.value},{withCredentials:!0});n.value=a,alert(`Inserted ${a.inserted} row(s)`+((_=a.errors)!=null&&_.length?`; ${a.errors.length} error(s)`:""))}catch(a){C.value=((i=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:i.detail)||((u=(c=a==null?void 0:a.response)==null?void 0:c.data)==null?void 0:u.error)||a.message}}function k(){f.value=`Participant ID,Record Scope,Data Source Label,Description,Date,Value
101,ACTUAL,NEW_ARR,ACME deal,2025-02-01,50000
101,FORECAST,RETAIN_NR,Q1 retain %,2025-02-15,0.78
102,ACT,ARR_QUOTA,Quota for Q1,2025-01-01,250000
102,FCST1,EXPANSION,Upsell,2025-03-10,12000`}return(_,e)=>{const i=R("router-link");return d(),m("div",P,[o(r(N),null,{default:l(()=>[o(r(E),{class:"fw-semibold d-flex justify-content-between align-items-center"},{default:l(()=>[e[3]||(e[3]=s("span",null,"Bulk Load Source Data (CSV)",-1)),s("div",h,[o(r(S),{color:"secondary",variant:"outline",onClick:k},{default:l(()=>e[1]||(e[1]=[t("Load Example",-1)])),_:1,__:[1]}),o(i,{class:"btn btn-outline-primary",to:{name:"SourceDataList"}},{default:l(()=>e[2]||(e[2]=[t("Back to List",-1)])),_:1,__:[2]})])]),_:1,__:[3]}),o(r(g),null,{default:l(()=>{var c;return[o(r(F),{onSubmit:x(D,["prevent"])},{default:l(()=>[o(r(U),{class:"g-3"},{default:l(()=>[o(r(M),{md:"12"},{default:l(()=>[o(r(A),null,{default:l(()=>e[4]||(e[4]=[t("Paste CSV",-1)])),_:1,__:[4]}),o(r(I),{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=u=>f.value=u),rows:"12",placeholder:"Participant ID,Record Scope,Data Source Label,Description,Date,Value",style:{"font-family":"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Courier New', monospace"}},null,8,["modelValue"]),e[5]||(e[5]=s("small",{class:"text-body-secondary"},[t(" Required headers: "),s("code",null,"Participant ID"),t(", "),s("code",null,"Data Source Label"),t(", "),s("code",null,"Date"),t(", "),s("code",null,"Value"),t(". Optional header: "),s("code",null,"Record Scope"),t(" (defaults to "),s("code",null,"ACTUAL"),t(" if omitted). Header names are flexible. ")],-1))]),_:1,__:[5]})]),_:1}),s("div",O,[o(r(S),{type:"submit",color:"primary"},{default:l(()=>e[6]||(e[6]=[t("Upload",-1)])),_:1,__:[6]}),o(i,{class:"btn btn-secondary",to:{name:"SourceDataList"}},{default:l(()=>e[7]||(e[7]=[t("Cancel",-1)])),_:1,__:[7]})])]),_:1}),C.value?(d(),L(r(y),{key:0,color:"danger",class:"mt-3"},{default:l(()=>[t(p(C.value),1)]),_:1})):b("",!0),n.value?(d(),m("div",Q,[o(r(y),{color:"success"},{default:l(()=>[t("Inserted: "+p(n.value.inserted),1)]),_:1}),(c=n.value.errors)!=null&&c.length?(d(),m("div",j,[s("h6",null,"Row errors ("+p(n.value.errors.length)+")",1),s("ul",q,[(d(!0),m(V,null,w(n.value.errors,(u,a)=>(d(),m("li",{key:a}," Line "+p(u.line)+" â€” "+p(u.error),1))),128))])])):b("",!0)])):b("",!0)]}),_:1})]),_:1})])}}};export{Y as default};

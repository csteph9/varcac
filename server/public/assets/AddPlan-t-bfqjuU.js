import{s as J,r as O,v as E,c as S,a as l,w as n,u as t,e as u,C as j,l as I,b as m,p as v,d as Q,k as x,t as D,F as z,f as X,g as Z,i as K,j as y,h}from"./index-C5PjdH1u.js";import{C as b}from"./CButton-CmOQe7lx.js";import{C as ee}from"./CCardHeader-ZktOyhiF.js";import{C as te}from"./CForm-CUo11SnN.js";import{C as p}from"./CFormInput-BqrKVkSy.js";import{C as le}from"./CFormSelect-BQ4o_mjU.js";import{C as ae}from"./CFormTextarea-BG8MIxIb.js";import{C as ne,a as C}from"./CRow-BjL7ivIQ.js";import{a as oe,b as P,c as _,d as re,C as se,e as V}from"./CTable-BpxxO1kN.js";const ue={class:"p-3"},de={class:"mt-4 pt-3 border-top"},ie={class:"d-flex justify-content-between align-items-center mb-2"},fe={class:"d-flex gap-2"},me={key:0,class:"text-danger mb-2"},pe={key:2,class:"text-body-secondary"},ve={class:"d-flex gap-2 mt-4"},Ue={__name:"AddPlan",setup(ye){const q=K(),r=J({name:"",version:"1.0",payoutFrequency:"",effectiveStart:"",effectiveEnd:"",description:""}),f=O([]),A=[{label:"Select…",value:""},{label:"Weekly",value:"Weekly"},{label:"Bi-Weekly",value:"Bi-Weekly"},{label:"Monthly",value:"Monthly"},{label:"Quarterly",value:"Quarterly"},{label:"Semi-Annual",value:"Semi-Annual"},{label:"Annual",value:"Annual"}],$=a=>String(a).padStart(2,"0"),T=a=>a?new Date(`${a}T00:00:00Z`):null,g=a=>`${a.getUTCFullYear()}-${$(a.getUTCMonth()+1)}-${$(a.getUTCDate())}`,w=(a,e)=>new Date(a.getTime()+e*864e5),c=(a,e)=>new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth()+e,a.getUTCDate())),B=(a,e,o)=>{const s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=a.getUTCFullYear(),i=a.getUTCMonth();switch((e||"").toLowerCase()){case"weekly":return`Week ${o+1} — ${s[i]} ${a.getUTCDate()}, ${d}`;case"bi-weekly":return`Bi-Week ${o+1} — ${s[i]} ${a.getUTCDate()}, ${d}`;case"monthly":return`${s[i]} ${d}`;case"quarterly":return`Q${Math.floor(i/3)+1} ${d}`;case"semi-annual":return`${i<6?"H1":"H2"} ${d}`;case"annual":return`${d}`;default:return`${s[i]} ${a.getUTCDate()}, ${d}`}},M=(a,e)=>{switch((e||"").toLowerCase()){case"weekly":return w(a,7);case"bi-weekly":return w(a,14);case"monthly":return c(a,1);case"quarterly":return c(a,3);case"semi-annual":return c(a,6);case"annual":return c(a,12);default:return c(a,1)}},N=()=>{f.value=[];const a=r.payoutFrequency,e=r.effectiveStart;if(!a||!e)return;const o=T(e);if(!o||isNaN(o))return;const s=r.effectiveEnd?T(r.effectiveEnd):null;let d=o,i=0;const G=500;for(;i<G;){const U=M(d,a);let k=w(U,-1);if(s&&k>s&&(k=s),f.value.push({start:g(d),end:g(k),label:B(d,a,i)}),s&&U>s||!s&&i>0&&g(k)===g(d)||(d=U,i++,s&&d>s))break}},L=()=>{f.value.push({start:r.effectiveStart||"",end:r.effectiveEnd||"",label:`Custom ${f.value.length+1}`})},R=a=>f.value.splice(a,1),F=E(()=>{const a=f.value;if(!a.length)return"";const e=[...a].sort((o,s)=>(o.start||"").localeCompare(s.start||""));for(let o=0;o<e.length;o++){const s=e[o];if(!s.start||!s.end)return"All periods must have start and end dates.";if(s.end<s.start)return"A period has an end date before its start.";if(o>0){const d=e[o-1];if(s.start<=d.end)return"Periods overlap or are not strictly ordered."}}return""}),W=E(()=>!!r.name),H=async()=>{const a={name:r.name,version:r.version||"1.0",payoutFrequency:r.payoutFrequency||null,effectiveStart:r.effectiveStart||null,effectiveEnd:r.effectiveEnd||null,description:r.description||null,payoutPeriods:f.value.map(e=>({start:e.start||null,end:e.end||null,label:e.label||null}))};await h.post("/api/plans",a,{withCredentials:!0}),alert("Plan saved!"),q.push({name:"PlansList"})},Y=()=>{Object.assign(r,{name:"",version:"1.0",payoutFrequency:"",effectiveStart:"",effectiveEnd:"",description:""}),f.value=[]};return(a,e)=>(y(),S("div",ue,[l(t(Z),null,{default:n(()=>[l(t(ee),{class:"fw-semibold"},{default:n(()=>e[6]||(e[6]=[u("Add New Plan",-1)])),_:1,__:[6]}),l(t(j),null,{default:n(()=>[l(t(te),{onSubmit:I(H,["prevent"])},{default:n(()=>[l(t(ne),{class:"g-3"},{default:n(()=>[l(t(C),{md:"8"},{default:n(()=>[l(t(v),null,{default:n(()=>e[7]||(e[7]=[u("Plan Name",-1)])),_:1,__:[7]}),l(t(p),{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=o=>r.name=o),placeholder:"FY2026 Sales Compensation"},null,8,["modelValue"])]),_:1}),l(t(C),{md:"4"},{default:n(()=>[l(t(v),null,{default:n(()=>e[8]||(e[8]=[u("Version",-1)])),_:1,__:[8]}),l(t(p),{modelValue:r.version,"onUpdate:modelValue":e[1]||(e[1]=o=>r.version=o)},null,8,["modelValue"])]),_:1}),l(t(C),{md:"4"},{default:n(()=>[l(t(v),null,{default:n(()=>e[9]||(e[9]=[u("Payout Frequency",-1)])),_:1,__:[9]}),l(t(le),{modelValue:r.payoutFrequency,"onUpdate:modelValue":e[2]||(e[2]=o=>r.payoutFrequency=o),options:A},null,8,["modelValue"])]),_:1}),l(t(C),{md:"3"},{default:n(()=>[l(t(v),null,{default:n(()=>e[10]||(e[10]=[u("Effective Start",-1)])),_:1,__:[10]}),l(t(p),{type:"date",modelValue:r.effectiveStart,"onUpdate:modelValue":e[3]||(e[3]=o=>r.effectiveStart=o)},null,8,["modelValue"])]),_:1}),l(t(C),{md:"3"},{default:n(()=>[l(t(v),null,{default:n(()=>e[11]||(e[11]=[u("Effective End",-1)])),_:1,__:[11]}),l(t(p),{type:"date",modelValue:r.effectiveEnd,"onUpdate:modelValue":e[4]||(e[4]=o=>r.effectiveEnd=o)},null,8,["modelValue"])]),_:1}),l(t(C),{md:"12"},{default:n(()=>[l(t(v),null,{default:n(()=>e[12]||(e[12]=[u("Description",-1)])),_:1,__:[12]}),l(t(ae),{modelValue:r.description,"onUpdate:modelValue":e[5]||(e[5]=o=>r.description=o),rows:"4",placeholder:"Brief description of the plan..."},null,8,["modelValue"])]),_:1})]),_:1}),m("div",de,[m("div",ie,[e[15]||(e[15]=m("h6",{class:"mb-0"},"Payout Periods",-1)),m("div",fe,[l(t(b),{color:"secondary",variant:"outline",onClick:N,disabled:!r.payoutFrequency||!r.effectiveStart,title:"Generate periods from Effective Start to Effective End"},{default:n(()=>e[13]||(e[13]=[u(" Generate from dates ",-1)])),_:1,__:[13]},8,["disabled"]),l(t(b),{color:"secondary",variant:"outline",onClick:L},{default:n(()=>e[14]||(e[14]=[u("Add period",-1)])),_:1,__:[14]})])]),e[23]||(e[23]=m("small",{class:"text-body-secondary d-block mb-2"},[u(" Generator anchors to "),m("strong",null,"Effective Start"),u(" and uses selected "),m("strong",null,"Payout Frequency"),u(". You can edit the dates/labels after generating. ")],-1)),F.value?(y(),S("div",me,D(F.value),1)):Q("",!0),f.value.length?(y(),x(t(se),{key:1,hover:"",responsive:"",small:""},{default:n(()=>[l(t(oe),null,{default:n(()=>[l(t(P),null,{default:n(()=>[l(t(_),{style:{width:"56px"}},{default:n(()=>e[16]||(e[16]=[u("#",-1)])),_:1,__:[16]}),l(t(_),{style:{"min-width":"160px"}},{default:n(()=>e[17]||(e[17]=[u("Start",-1)])),_:1,__:[17]}),l(t(_),{style:{"min-width":"160px"}},{default:n(()=>e[18]||(e[18]=[u("End",-1)])),_:1,__:[18]}),l(t(_),null,{default:n(()=>e[19]||(e[19]=[u("Label",-1)])),_:1,__:[19]}),l(t(_),{style:{width:"90px"}},{default:n(()=>e[20]||(e[20]=[u("Actions",-1)])),_:1,__:[20]})]),_:1})]),_:1}),l(t(re),null,{default:n(()=>[(y(!0),S(z,null,X(f.value,(o,s)=>(y(),x(t(P),{key:s},{default:n(()=>[l(t(V),null,{default:n(()=>[u(D(s+1),1)]),_:2},1024),l(t(V),null,{default:n(()=>[l(t(p),{type:"date",modelValue:o.start,"onUpdate:modelValue":d=>o.start=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(t(V),null,{default:n(()=>[l(t(p),{type:"date",modelValue:o.end,"onUpdate:modelValue":d=>o.end=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(t(V),null,{default:n(()=>[l(t(p),{modelValue:o.label,"onUpdate:modelValue":d=>o.label=d,placeholder:"e.g., Jan 2026"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(t(V),null,{default:n(()=>[l(t(b),{color:"danger",size:"sm",variant:"ghost",onClick:d=>R(s)},{default:n(()=>e[21]||(e[21]=[u(" Remove ",-1)])),_:2,__:[21]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(y(),S("div",pe,e[22]||(e[22]=[u(" No periods yet. Click ",-1),m("em",null,"Generate from dates",-1),u(" or ",-1),m("em",null,"Add period",-1),u(". ",-1)])))]),m("div",ve,[l(t(b),{type:"submit",color:"primary",disabled:!W.value},{default:n(()=>e[24]||(e[24]=[u("Save",-1)])),_:1,__:[24]},8,["disabled"]),l(t(b),{type:"button",color:"secondary",onClick:Y},{default:n(()=>e[25]||(e[25]=[u("Reset",-1)])),_:1,__:[25]})])]),_:1})]),_:1})]),_:1})]))}};export{Ue as default};
